<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="public/icons/logo_orange.png">
    <title>Devices</title>
    <!--<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,400italic,700,800" rel="stylesheet"-->
    <!--type="text/css">-->
    <!--<link href="http://fonts.googleapis.com/css?family=Raleway:300,200,100" rel="stylesheet" type="text/css">-->
    <!--<link href="http://fonts.googleapis.com/css?family=Open+Sans+Condensed:300,700" rel="stylesheet" type="text/css">-->
    <link href="public/lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="public/lib/font-awesome/css/font-awesome.min.css">
    <!--if lt IE 9script(src='https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js')-->
    <link rel="stylesheet" type="text/css" href="public/css/bootstrap-table.css">
    <link rel="stylesheet" type="text/css" href="public/lib/jquery.nanoscroller/css/nanoscroller.css">
    <link rel="stylesheet" type="text/css" href="public/lib/jquery.niftymodals/css/component.css">
    <link href="public/css/style.css" rel="stylesheet">
</head>

<body>
<div id="head-nav" class="navbar navbar-default navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span
                    class="fa fa-gear"></span></button>
            <a href="#">
                <!--logo start-->
            <span>
         <img src="public/icons/logo_white.png" style=" height:100%; width:80%;">
               </span>
                <!--logo end-->
            </a>
        </div>
        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right user-nav">
                <li class="dropdown profile_menu"><a href="#" data-toggle="dropdown"
                                                     class="dropdown-toggle"><span></span><b
                        class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="/settings.html">Settings</a></li>
                        <!--<li class="divider"></li>-->
                        <!--<li><a href="/login/">Sign Out</a></li>-->
                    </ul>
                </li>
            </ul>
            </ul>
        </div>
    </div>
</div>
<div id="cl-wrapper">
    <!--Sidebar item function-->
    <!--Sidebar sub-item function-->
    <div class="cl-sidebar">
        <div class="cl-toggle"><i class="fa fa-bars"></i></div>
        <div class="cl-navblock">
            <div class="menu-space">
                <div class="content">
                    <ul class="cl-vnavigation">
                        <li><a href="#"><i class="fa fa-file"></i><span>Admin</span></a>
                            <ul class="sub-menu">
                                <li id="dashboard"><a href="/dashboard.html">Dashboard</a>
                                </li>
                                <li id="dev_manage_page"><a href="/index.html">Device Management</a>
                                </li>
                                <li id="live_data_page"><a href="/live_data.html">Streaming Data</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div id="pcont" class="container-fluid">
        <div class="page-head">
            <h2>Dashboard</h2>
        </div>
        <div class="cl-mcont">
            <div class="row">
                <div class="block-flat">
                    <div class="header">
                        <h3>Setting</h3>
                    </div>
                    <div class="content">
                        <div class="row">
                            <div class="col-sm-3 col-md-12">
                                <label class="control-label">ESHOW KEY</label>

                                <p>Change ESHOW KEY as you want.</p>
                            </div>
                            <div class="col-sm-3 col-md-6">
                                <form id="edit_id" method="post">
                                    <input type="text" name='eshow_id' id='eshow_id' class="form-control">
                                </form>
                            </div>
                            <div class="col-sm-3 col-md-3">
                                <button type="button" class="btn btn-primary" id="create_id">Create ID/EDIT</button>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-3 col-md-12">
                                <label class="control-label">Client KEY</label>

                                <p>Change Client KEY as you want.</p>
                            </div>
                            <div class="col-sm-3 col-md-6">
                                <form id="client_form" method="post">
                                    <input type="text" name='client_key' id='client_key' class="form-control">
                                </form>
                            </div>
                            <div class="col-sm-3 col-md-3">
                                <button type="button" class="btn btn-primary" id="create_key">Create key/EDIT</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="block-flat">
                        <div class="header">
                            <h3 style="font-size: medium">Devices Overview</h3>
                        </div>
                        <div class="content">
                            <!-------------------- Start Add Device Nifty Modal--------------------------->
                            <div class="table-responsive">
                                <table id="dev_table" class="table no-border hover">
                                    <thead class="no-border">
                                    <tr>
                                        <th style="width:15%;" class="text-center"><strong>Name</strong></th>
                                        <th style="width:15%;" class="text-center"><strong>MAC Address</strong></th>
                                        <th style="width:15%;" class="text-center"><strong>IP Address</strong></th>
                                        <th style="width:15%;" class="text-center"><strong>Power Level</strong></th>
                                        <th style="width:40%;" class="text-center"><strong>Action</strong></th>
                                    </tr>
                                    </thead>
                                    <tbody id="dev_tbody" class="no-border-y"></tbody>
                                </table>
                            </div>
                            <!---------------------Start Edit Modal----------------------------------->
                            <div id="form-edit" class="md-modal colored-header primary md-effect-9">
                                <div class="md-content">
                                    <div class="modal-header">
                                        <h3 id="enable-h3">Edit Device</h3>
                                        <button type="button" data-dismiss="modal" aria-hidden="true"
                                                class="close md-close">×
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <form id="edit_device" method="post">
                                            <div class="modal-body form">
                                                <div class="form-group">
                                                    <label>Name</label>
                                                    <input type="text" name='name' class="form-control">
                                                </div>
                                                <div class="form-group">
                                                    <label>MAC ADDRESS</label>
                                                    <input type="text" name='mac_address' class="form-control"
                                                           readonly="readonly">
                                                </div>
                                                <div class="form-group">
                                                    <label>IP Address</label>
                                                    <input type="text" name='ip_address' class="form-control"
                                                           readonly="readonly">
                                                </div>
                                                <div class="form-group">
                                                    <label>Power Level (0 ~ 255)</label>
                                                    <input type="text" name='power_level' class="form-control">
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" data-dismiss="modal"
                                                class="btn btn-default btn-flat md-close">Cancel
                                        </button>
                                        <button id="proceed_edit" type="submit" data-dismiss="modal"
                                                class="btn btn-primary btn-flat md-close">Proceed
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <!---------------------------End Edit Nifty Modal-------------------------------->

                            <!---------------------------Start Remove Nifty Modal------------------------------>
                            <div id="form-remove" class="md-modal colored-header danger md-effect-9">
                                <div class="md-content">
                                    <div class="modal-header">
                                        <h3 id="remove-h3">Delete Device</h3>
                                        <button type="button" data-dismiss="modal" aria-hidden="true"
                                                class="close md-close">×
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="text-center">
                                            <div class="i-circle danger"></div>
                                            <h4 id="remove-h4">Are you sure you want to remove this device?</h4>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" data-dismiss="modal"
                                                class="btn btn-default btn-flat md-close">Cancel
                                        </button>
                                        <button type="button" id="proceed_remove" data-dismiss="modal"
                                                class="btn btn-primary btn-flat md-close">Proceed
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <!------------------------------End Remove Nifty Modal------------------------------>
                            <div class="md-overlay"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="block-flat">
                    <div class="header">
                        <h3>Streaming Data</h3>
                    </div>
                    <div class="content">
                        <table class="no-border" id="data_stream_table"
                               style="width:100%;max-height: 700px;overflow-y: scroll;">
                            <thead class="no-border">
                            <tr>
                                <th class="text-left" style="width:30%;">Antenna</th>
                                <th class="text-left" style="width:30%;">EPC Number/TAG ID /DATA</th>
                                <th class="text-left" style="width:40%;">Custom DATA</th>
                                <th class="text-right" style="width:30%;">Date</th>
                            </tr>
                            </thead>
                            <tbody class="no-border-y" id="data_stream_body">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Streaming Data-->

    </div>
</div>
</div>
<script type="text/javascript" src="public/lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="public/lib/jquery.nanoscroller/javascripts/jquery.nanoscroller.js"></script>
<script type="text/javascript" src="public/js/cleanzone.js"></script>
<script src="public/lib/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="public/js/voice-recognition.js"></script>
<script src="public/lib/jquery.niftymodals/js/jquery.modalEffects.js" type="text/javascript"></script>
<script type="text/javascript">
    $('#dashboard').addClass("active");
    //<-------------------------ajax setup with crsfkey---------------------------->
    $(document).ready(function () {
        //initialize the javascript
        App.init();
        $('.md-trigger').modalEffects();
        pageloads();
        settingloads();
    });

    // Device List
    var dev_list = [];
    var remove_address;
    function pageloads() {

        $.getJSON('/api/device/list/', function (data) {
            dev_list = [];
            dev_list = data;
            $('#dev_tbody').empty();
            $.each(data, function (key, item) {
                var tr = $("<tr>");
                tr.append("<td class=\"text-center\">" + item.name + "</td>");
                tr.append("<td class=\"text-center\">" + item.mac_address + "</td>");
                tr.append("<td class=\"text-center\">" + item.address + "</td>");
                tr.append("<td class=\"text-center\">" + item.power + "</td>");
                tr.append("<td class=\"text-center\"><div class=\"btn-group\"><button data-modal=\"form-edit\" type=\"button\" data-id=\"" + item.mac_address + "\" class=\"btn btn-primary btn-flat btn-sm md-trigger\">Edit</button>" +
                        "<button data-modal=\"form-remove\" type=\"button\" data-id=\"" + item.mac_address + "\" class=\"btn btn-danger btn-flat btn-sm md-trigger\"><i class=\"fa fa-times\"></i>Remove</button></div></td>");
                tr.append("</tr>");
                $('#dev_tbody').append(tr);
            });
            $('.md-trigger').modalEffects();

            $('.md-trigger').click(function () {
                //Get the record's ID via attribute
                var address = $(this).attr('data-id');
                var data_modal = $(this).attr('data-modal');

                var i = 0;
                for (i = 0; i < dev_list.length; ++i) {
                    if (dev_list[i].mac_address == address) {
                        load_data(address, dev_list[i], data_modal);
                        break;
                    }
                }
            });
        });
    }

    // Bind on proceed_edit button.
    $('#proceed_edit').click(function () {
        var name = $('#edit_device').find('input[name="name"]').val();
        var mac_address = $('#edit_device').find('input[name="mac_address"]').val();
        var ip_address = $('#edit_device').find('input[name="ip_address"]').val();
        var power_level = $('#edit_device').find('input[name="power_level"]').val();

        $.ajax({
            url: "/api/update/",
            type: 'POST',
            data: {name: name, mac_address: mac_address, address: ip_address, power: power_level}
        }).success(function (data) {
            alert(data);
            pageloads();
        }).error(function (data) {
            alert(data);
        });
    });

    // bind on proceed remove button.
    $('#proceed_remove').click(function () {

        $.ajax({
            url: "/api/delete/",
            type: 'POST',
            data: {address: remove_address}
        }).success(function (data) {
            alert(data);
            $('#dev_tbody').empty();
            pageloads();
        }).error(function (data) {
            alert(data);
        });
    });


    function load_data(address, data, data_modal) {
        var j = 0;
        if (data_modal == "form-edit") {
            $('#edit_device')
                    .find('[name="name"]').val(data.name).end()
                    .find('[name="mac_address"]').val(data.mac_address).end()
                    .find('[name="ip_address"]').val(data.address).end()
                    .find('[name="power_level"]').val(data.power).end();

        }
        else if (data_modal == "form-remove") {
            remove_address = address;
        }
    }

    // Display the streaming Data.
    function dataload() {
        $.getJSON('/api/stream/', function (data) {
            $('#data_stream_body').empty();
            $.each(data, function (key, item) {
                var tr = $("<tr>");
                if (parseInt(item.antenna) == 1)
                    antenna_level = "Antenna_1";
                else if (parseInt(item.antenna) == 2)
                    antenna_level = "Antenna_2";
                tr.append("<td class=\"text-left\">" + antenna_level + "</td>");
                tr.append("<td class=\"text-left\">" + item.EPC + "</td>");
                tr.append("<td class=\"text-left\">" + item.Custom + "</td>");
                tr.append("<td class=\"text-right\">" + item.time + "</td>");
                tr.append("</tr>");
                $('#data_stream_body').append(tr);
            });
        });
    }

    // Loading the eshow id.
    function settingloads() {
        $.getJSON('/api/id/', function (data) {
            $.each(data, function (key, item) {
                $('#edit_id')
                        .find('[name="eshow_id"]').val(item.eshow_id).end();
                $('#client_form')
                        .find('[name="client_key"]').val(item.client_key).end();
            });
        });
    }

    // Create and Edit the eshow id.
    $("#create_id").click(function () {
        var eshow_id = $('#edit_id').find('input[name="eshow_id"]').val();
        $.ajax({
            url: "/api/id/",
            type: 'POST',
            data: {eshow_id: eshow_id}
        }).success(function (data) {
            alert(data);
            $('#edit_id')
                    .find('[name="eshow_id"]').val(eshow_id).end();
        }).error(function (data) {
            alert(data);
        });
    });
    // Create and Edit the eshow id.
    $("#create_key").click(function () {
        var client_key = $('#client_form').find('input[name="client_key"]').val();

        $.ajax({
            url: "/api/key/",
            type: 'POST',
            data: {client_key: client_key}
        }).success(function (data) {
            alert(data);
            $('#client_form')
                    .find('[name="client_key"]').val(client_key).end();
        }).error(function (data) {
            alert(data);
        });
    });
</script>
</body>
</html>